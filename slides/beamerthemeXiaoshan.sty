% beamerthemeXiaoshan.sty v1.0 2018/04/09
% by LianTze Lim (liantze@gmail.com)
\ProvidesPackage{beamerthemeXiaoshan}

\usetheme[progressbar=frametitle]{metropolis}

\RequirePackage{pgfornament-han}
\RequirePackage{tikz}
\usetikzlibrary{decorations,decorations.markings}
\RequirePackage{cncolours}
\RequirePackage{needspace}

\setbeamertemplate{frametitle continuation}[from second]

\renewcommand{\metropolis@colors@dark}{
  \setbeamercolor{normal text}{%
    fg=black!2,
    bg=漆黑
  }
  \usebeamercolor[fg]{normal text}
}
\renewcommand{\metropolis@colors@light}{
  \setbeamercolor{normal text}{%
    fg=漆黑,
    bg=black!2
  }
  \usebeamercolor[fg]{normal text}
}

\metroset{background=light}

\setbeamercolor{alerted text}{fg=酡红}
\setbeamercolor{example text}{fg=靛蓝}

\AtBeginEnvironment{theorem}{%
  \setbeamercolor{block title}{fg=松花绿}
}

\AtBeginEnvironment{proof}{%
  \setbeamercolor{block title}{fg=松花绿}
}

\setbeamercolor{qed symbol}{fg=松花绿}

\setbeamertemplate{title}{
\raggedleft%
\linespread{1.0}%
\inserttitle%
\hspace*{2em}\par%
\vspace*{0.5em}
}

\setbeamertemplate{subtitle}{
\raggedleft%
\insertsubtitle%
\hspace*{2em}\par%
\vspace*{0.5em}
}
\addtobeamertemplate{author}{\raggedleft}{}
\addtobeamertemplate{date}{\raggedleft}{}

\setbeamertemplate{progress bar in head/foot}{
  \nointerlineskip
  \setlength{\metropolis@progressinheadfoot}{%
    \paperwidth * \ratio{\insertframenumber pt}{\inserttotalframenumber pt}%
  }%
  \begin{beamercolorbox}[wd=\paperwidth]{progress bar in head/foot}
    \begin{tikzpicture}%
      \newbox{\orn}
      \savebox{\orn}{\pgfornamenthan[width=1em]{39}}
      \fill[bg!60] (0,0) rectangle (\paperwidth, .55em);
       \clip (0,0) rectangle (\metropolis@progressinheadfoot, .55em);
       \begin{scope}[decoration={markings, mark=between positions 0 and 1 step 1em
  with { \node[transform shape,inner sep=0pt,outer sep=0pt,draw=none]{\usebox{\orn}}; }} ]
       \path [postaction={decorate}] (.5em,.275em) -- (\dimexpr\metropolis@progressinheadfoot+0.5em, .275em);
     \end{scope}%
    \end{tikzpicture}%
  \end{beamercolorbox}
}

\setbeamertemplate{progress bar in section page}{
  \setlength{\metropolis@progressonsectionpage}{%
    \textwidth * \ratio{\insertframenumber pt}{\inserttotalframenumber pt}%
  }%
  \begin{tikzpicture}
    \newbox{\orn}
    \savebox{\orn}{\pgfornamenthan[width=.8em]{39}}
    \fill[bg!60] (0,0) rectangle (\textwidth, .44em);
     \clip (0,0) rectangle (\metropolis@progressonsectionpage, .44em);
     \begin{scope}[decoration={markings, mark=between positions 0 and 1 step .8em
with { \node[transform shape,inner sep=0pt,outer sep=0pt,draw=none]{\usebox{\orn}}; }} ]
     \path [postaction={decorate}] (.4em,.22em) -- (\dimexpr\metropolis@progressonsectionpage+0.5em, .22em);
   \end{scope}%
  \end{tikzpicture}%
}

\setbeamertemplate{title separator}{%
  \vspace*{-5em}%
  \begin{tikzpicture}
    \newbox{\orn}
    \savebox{\orn}{\pgfornamenthan[width=2em]{31}}
    \node[anchor=south east,inner sep=0pt,outer sep=0pt] (endmotif) at (\textwidth,0){\pgfornamenthan[width=2em,symmetry=c]{13}};
    % \node[rotate=90,anchor=south west,inner sep=0pt,outer sep=0pt] at (endmotif.north east) {\pgfornamenthan[width=2em]{31}};
    \begin{scope}[decoration={markings, mark=between positions 0 and 1 step 2em
      with { \node[transform shape,inner sep=0pt,outer sep=0pt,anchor=south]{\usebox{\orn}}; }} ]
    \path [postaction={decorate}] ([yshift=1em]endmotif.north east) -- ++(0,2em);
    \clip (0,1em) rectangle ([yshift=-2pt]endmotif.south west);
    \path [postaction={decorate}] (1em, 0) -- (\textwidth,0);
    \end{scope}%
  \end{tikzpicture}%
\par
}

\@ifpackageloaded{ctex}{%
  \renewcommand{\metropolis@strut}{%
    \vphantom{ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz()\rule[-6pt]{1em}{0pt}}%
  }
}{}

\@ifpackageloaded{CJK}{%
  \renewcommand{\metropolis@strut}{%
    \vphantom{ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz()\rule[-6pt]{1em}{0pt}}%
  }
}{}






\makeatletter
%\patchcmd{\beamer@sectionintoc}{\vfill}{\vskip2\itemsep}{}{}
\patchcmd{\beamer@sectionintoc}{\vskip1.5em}{\vskip0.5em}{}{}
\makeatother

\setlength{\parskip}{\smallskipamount}
%\setlength{\parskip}{0.1em}

\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[square]
\setbeamertemplate{itemize subsubitem}[ball]
\setbeamertemplate{enumerate item}[circle]
\setbeamertemplate{enumerate subitem}[square]
\setbeamertemplate{enumerate subsubitem}[ball]



%%%%%%%%%%%%%%
%%% commands
%%%%%%%%%%%%%%

% some colors
\definecolor{AmurmapleRed}{rgb}{0.6,0.,0.}
\definecolor{AmurmapleOrange}{RGB}{230,108,17}
\definecolor{AmurmapleBlue}{RGB}{55,119,231}
\definecolor{AmurmapleGreen}{rgb}{0.1,0.4,0.1}

\colorlet{Amurmaple@structure}{AmurmapleOrange}
\colorlet{Amurmaple@alert}{AmurmapleRed}
\colorlet{Amurmaple@info}{AmurmapleBlue}
\colorlet{Amurmaple@example}{AmurmapleGreen}
\colorlet{Amurmaple@rule}{black}

\setbeamercolor{alerted text}{fg=Amurmaple@alert,bg=Amurmaple@alert!20}

\newenvironment{boxalertenv}{\begin{altenv}%
      {\usebeamertemplate{alerted text begin}\usebeamercolor[fg]{alerted text}\usebeamerfont{alerted text}\colorbox{bg}}
      {\usebeamertemplate{alerted text end}}{\color{.}}{}}{\end{altenv}}
\newcommand<>{\boxalert}[1]{{%
  \begin{boxalertenv}#2{#1}\end{boxalertenv}%
}}

\RequirePackage{tcolorbox}
\tcbuselibrary{skins}

\NewDocumentEnvironment{remark}{o}{
   \tcbset{%
    arc=0pt,outer arc=0pt,colback=gray!10!white,colframe=gray!60!white,
    boxsep=0pt,left=10pt,right=10pt,top=8pt,bottom=10pt, bottomtitle = 3pt, toptitle=3pt,
    boxrule=0pt,bottomrule=0.5pt,toprule=0.5pt
  }
  \smallskip
  \begin{tcolorbox}[fonttitle=\bfseries,title={\translate{Remark} \IfNoValueF{#1}{(#1)}}]}%
  {\end{tcolorbox}\medskip
}

\newcommand\amurmapleinfo{\raisebox{-1mm}{\tikz{\node[circle,fill=Amurmaple@info,align=center,text
      width=1em,inner sep = 0.0mm]
      {\rmfamily\itshape\bfseries\color{white} i};}}}
\NewDocumentEnvironment{information}{o}{%
  \tcbset{leftrule=1mm,rightrule=0mm,toprule=0mm, bottomrule=0mm,%
    colframe=Amurmaple@info,
    sharp corners,
    detach title,%
    before title={\amurmapleinfo~},
    fonttitle = \color{black}\bfseries\sffamily,
    before upper={\tcbtitle\par\medskip}
  }
  \IfNoValueTF{#1}{%
    \begin{tcolorbox}[title=\translate{Information}]
    }{
      \begin{tcolorbox}[title=#1]
      }
    }%
    {%
    \end{tcolorbox}
  }%

\RenewDocumentEnvironment{quotation}{o}{%
  \begin{tcolorbox}[boxrule=0pt,frame hidden,sharp corners,enhanced,borderline west={4pt}{0pt}{Amurmaple@info}]\itshape
  }
  {%
    \IfNoValueTF{#1}{%
    }{
      \begin{flushright}
        \normalfont #1
      \end{flushright}
    \end{tcolorbox}%
  }%
}

\setbeamertemplate{blocks}[rounded][shadow]
\setbeamercolor{block body}{fg=black,bg=gray!10}
\setbeamercolor{block title}{fg=Amurmaple@info,bg=Amurmaple@info!40}
\setbeamercolor{block body alerted}{fg=black,bg=gray!10}
\setbeamercolor{block title alerted}{fg=Amurmaple@alert,bg=Amurmaple@alert!40}
\setbeamercolor{block body example}{fg=black,bg=gray!10}
\setbeamercolor{block title example}{fg=Amurmaple@example,bg=Amurmaple@example!40}

\AtBeginEnvironment{definition}{%
  \setbeamercolor{block body}{fg=black,bg=gray!10}
  \setbeamercolor{block title}{fg=Amurmaple@structure,bg=Amurmaple@structure!40}
}








\endinput
